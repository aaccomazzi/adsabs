{# I get the links #}
{% set links = solrdoc.getattr_func('links_data', g.formatter_funcs.field_to_json) %}
{% set link_types = [] %}{% if links %}{% for link in links %}{% if link.get('type') %}{% do link_types.append(link.get('type')) %}{% endif %}{% endfor %}{% endif %}
{# I get the ids #}
{% set ids = solrdoc.getattr_func('ids_data', g.formatter_funcs.field_to_json) %}
{% set id_types = [] %}{% if ids %}{% for id in ids %}{% if id.get('description') %}{% do id_types.append(id.get('description')) %}{% endif %}{% endfor %}{% endif %}
{% set arxiv_id = [] %}{% if ids %}{% for id in ids %}{% if id.get('description') =='arXiv' %}{% do arxiv_id.append(id.get('identifier')) %}{% endif %}{% endfor %}{% endif %}
{# few variables to build the letters #}
{% if solrdoc.property %}{% if 'ADS_SCAN' in solrdoc.property %}{% set ads_scan = True %}{% else %}{% set ads_scan = False %}{%endif%}{% else %}{% set ads_scan = False %}{% endif %}
{% if solrdoc.property %}{% if 'PUB_OPENACCESS' in solrdoc.property %}{% set pub_openaccess = True %}{% else %}{% set pub_openaccess = False %}{%endif%}{% else %}{% set pub_openaccess = False %}{% endif %}
{% if solrdoc.property %}{% if 'PRIVATE' in solrdoc.property %}{% set private_abstract = True %}{% else %}{% set private_abstract = False %}{%endif%}{% else %}{% set private_abstract = False %}{% endif %}
		
<div class="container-fluid absview">
	<div class="row-fluid">
		<div id="abstractContent" class="span9">
			<div class="content-fluid">
				<div class="row-fluid">
					<div class="span12 abstractTitle">{% if solrdoc.title %}{{ solrdoc.title[0] }}{% else %}No title{% endif %}</div>
				</div>
				{% if inveniodoc.author %}
				<div class="row-fluid">
					<div class="span12 abstractAuthors">
						{% for author in inveniodoc.author %}
							<span class="author {% if loop.index > 10%}authorMoreTen strHidden{% endif %}">
								<span class="authorName">{{ author.name }}</span>
								{% if author.affiliations %}
								<span class="authorAffiliation strHidden">(
									{% for aff in author.affiliations %}
										{{ aff }}{% if not loop.last %}; {% endif %}
									{% endfor %}
								)</span>{% endif %}{% if not loop.last %}; {% endif %}
							</span>
						{% endfor %}
						{% if inveniodoc.author|length > 10 %}<a class="coauthorsToggle"> <span class="textToggle">and</span> {{ inveniodoc.author|length - 10 }} coauthors </a>{% endif %}
						{% if solrdoc.aff %}<a class="affiliationToggle blockToggle"> <span class="textToggle">show</span> affiliations </a>{% endif %}
					</div>
				</div>
				{% endif %}
				<div class="row-fluid">
					<div class="span12">
						<div class="abstractJournal">
							{% if solrdoc.pub_raw %}
								{{ solrdoc.pub_raw|safe }}
								{#% if solrdoc.pub %}
								<span class="journalNormalized">({{ solrdoc.pub }})</span>
								{% endif %#}
							{% endif %}
						</div>
						<div class="abstractPubdate">
							<span class="pubdate">Published in {{ solrdoc.pubdate|format_ads_date}}</span>
						</div>
						{% if solrdoc.doi %}
						<div class="abstractDOI">DOI:
							<span class=doi>
							{% for doistr in solrdoc.doi %}<a href="{{ doistr|ads_url_redirect(id_type='doi') }}" target="_blank">{{ doistr }}</a>{% if not loop.last %}; {% endif %}{% endfor %}
							</span>
						</div>
						{% endif %}
					</div>
				</div>
				<div class="row-fluid">
					<div class="span12 abstractAbstract">
						<span class="abstract">
							{% if not private_abstract %}
								{% if solrdoc.abstract %}{{ solrdoc.abstract|safe_html_unescape|safe }}{% else %}Abstract not available.{% endif %}
							{% else %}
								Abstract available on the 
								{% if 'electr' in link_types %}
								<a target="_blank" href="{{ solrdoc.bibcode|ads_url_redirect(id_type='electr') }}">publisher website</a>.
								{% else %}
								publisher website.
								{% endif %}
							{% endif %}
						</span>
					</div>
				</div>
				{% if inveniodoc.keyword.free or inveniodoc.keyword.controlled %}
				<div class="row-fluid">
					<div class="span12 abstractKeyword">
						<span class="keywordTitle blockToggle">Keywords:</span>
						{% if inveniodoc.keyword.free %}
							<div class="keywordGroup">
								<span class="keywordTitle">Free Keywords:</span>
								{% for key in inveniodoc.keyword.free %}<span class="keywordKey">{{ key.keyword }}</span>{% if not loop.last %}; {% endif %}{% endfor %}
							</div>
						{% endif %}
						{% if inveniodoc.keyword.controlled %}
							{% for schema in inveniodoc.keyword.controlled %}
								<div class="keywordGroup">
									<span class="keywordTitle">{{ schema }}:</span>
									{% for key in inveniodoc.keyword.controlled[schema] %}<span class="keywordKey">{{ key.keyword }}</span>{% if not loop.last %}; {% endif %}{% endfor %}
								</div>
							{% endfor %}
						{% endif %}
					</div>
				</div>
				{% endif %}
				
				{% if arxiv_id %}
				<div class="row-fluid">
					<div class="span12 abstractArXiv">
						<span class=arXivLink><span class="title">arXiv: </span><a href="{{ arxiv_id[0]|ads_url_redirect(id_type='arXiv') }}">{{ arxiv_id[0] }}</a></span>
					</div>
				</div>
				{% endif %}
				
				{% if solrdoc.copyright %}
				<div class="row-fluid">
					<div class="span12 abstractCopyright">
						<span class=copyright>{{ solrdoc.copyright }}</span>
					</div>
				</div>
				{% endif %}
			</div>
		</div>
		
		
		{% if ('electr' in link_types) or (ads_scan or 'pdf' in link_types) or (ads_scan) or 
		(current_user.is_authenticated() and 'electr' in link_types and not pub_openaccess and not ads_scan) or ('arXiv' in id_types) 
		or ('data' in link_types) or ('simbad' in link_types) or ('ned' in link_types) %}
		<div id="abstractRightMenu" class="span3 linkRightMenu">
			{% if ('electr' in link_types) or (ads_scan or 'pdf' in link_types) or (ads_scan) or 
			(current_user.is_authenticated() and 'electr' in link_types and not pub_openaccess and not ads_scan) or ('arXiv' in id_types) %}
			<dl>
				<dt>Full Text Sources</dt>
				{% if 'electr' in link_types %}<dd><a target="_blank" href="{{ solrdoc.bibcode|ads_url_redirect(id_type='electr') }}">Publisher article</a>{% if pub_openaccess %} <img alt="Open Access" title="Open Access" src="{{ url_for('static', filename='images/Open_Access_logo.png') }}"/>{% endif %}</dd>{% endif %}
				{% if ads_scan or 'pdf' in link_types %}<dd><a target="_blank" href="{{ solrdoc.bibcode|ads_url_redirect(id_type='article') }}">{% if ads_scan %}ADS PDF{% elif 'pdf' in link_types %}Publisher PDF{% endif %}</a>{% if ads_scan or pub_openaccess%} <img alt="Open Access" title="Open Access" src="{{ url_for('static', filename='images/Open_Access_logo.png') }}"/>{% endif %}</dd>{% endif %}
				{% if ads_scan %}<dd><a target="_blank" href="{{ solrdoc.bibcode|ads_url_redirect(id_type='gif') }}">ADS Scanned Article</a>  <img alt="Open Access" title="Open Access" src="{{ url_for('static', filename='images/Open_Access_logo.png') }}"/></dd>{% endif %}
				{% if current_user.is_authenticated() and 'electr' in link_types and not pub_openaccess and not ads_scan %}<dd><a target="_blank" href="{{ solrdoc.bibcode|ads_url_redirect(id_type='openurl') }}">Open URL</a></dd>{% endif %}
				{% if 'arXiv' in id_types %}<dd><a target="_blank" href="{{ solrdoc.bibcode|ads_url_redirect(id_type='preprint') }}">arXiv eprint</a> <img alt="Open Access" title="Open Access" src="{{ url_for('static', filename='images/Open_Access_logo.png') }}"/></dd>{% endif %}
			</dl>
			{% endif %}
			{% if ('data' in link_types) or ('simbad' in link_types) or ('ned' in link_types) %}
			<dl>
				<dt>Data Products</dt>
				{% if 'data' in link_types %}<dd><a target="_blank" href="{{ solrdoc.bibcode|ads_url_redirect(id_type='data') }}">Archival Data</a></dd>{% endif %}
				{% if 'simbad' in link_types %}<dd><a target="_blank" href="{{ solrdoc.bibcode|ads_url_redirect(id_type='simbad') }}">SIMBAD objects</a></dd>{% endif %}
				{% if 'ned' in link_types %}<dd><a target="_blank" href="{{ solrdoc.bibcode|ads_url_redirect(id_type='ned') }}">NED objects</a></dd>{% endif %}
			</dl>
			{% endif %}
		</div>
		{% endif %}
	</div>
	
	<script type="text/javascript">
		//toggle for the coauthors in a list with more than 10 authors 
		$('.coauthorsToggle').on('click', function(){
			//I show or hide the coauthors 
			$('.authorMoreTen').toggleClass('strHidden');
			//I show the link in a newline when all the authors are visible 
			$(this).toggleClass('blockToggle');
			// then I change the text in the link 
			if ($('.coauthorsToggle > span.textToggle').html() == 'and')
				$('.coauthorsToggle > span.textToggle').html('hide');
			else
				$('.coauthorsToggle > span.textToggle').html('and');
		});
		//toggle for the affiliations 
		$('.affiliationToggle').on('click', function(){
			//I show or hide the affiliations 
			$('.authorAffiliation').toggleClass('strHidden');
			// then I change the text in the link 
			if ($('.affiliationToggle > span.textToggle').html() == 'show')
				$('.affiliationToggle > span.textToggle').html('hide');
			else
				$('.affiliationToggle > span.textToggle').html('show');
		});
	</script>
</div>
