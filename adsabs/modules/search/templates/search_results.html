{# Global imports #}
{% from "macros/record_list_macros/results.html" import render_search_result with context %}
{% from "macros/record_list_macros/facets.html" import render_facet_box, render_2level_hier_facet_box, render_applied_facets_box with context %}
{% from "macros/record_list_macros/pagination.html" import render_pagination, render_result_numbers with context %}
{% from "macros/record_list_macros/button_menu.html" import render_re_sort with context %}
{% from "macros/search_macros.html" import render_search_form with context %}

{% extends "layout.html" %}

{% block titlehead %}Search Results: {{ resp.get_query() }}{% endblock %}

{% block head%}{% endblock %}

{% block body %}

{{ render_search_form(form) }}

<div class="container searchResults">
	<div class="row">
		<div class="span3" id="facets">
			<div class="accordion facetAccordion" id="accordion{{ facetid_html }}">
				<div class="accordion-group">
					<div class="accordion-heading">
						<div class="accordion-toggle facetAccordionHeader" data-toggle="" href="">
						  <strong>Limit your search</strong>
						</div>
					</div>
				</div>
			{{ render_2level_hier_facet_box('aut_f', 'Authors', resp, open=True) }}
			{{ render_facet_box('key_f', 'Keywords', resp) }}
			{{ render_facet_box('bib_f', 'Publications', resp) }}
			{{ render_facet_box('prop_f', 'Refereed status', resp, limit_to=['refereed', 'not refereed'], facetid_html='refereed_f') }}
			{{ render_facet_box('bibgr_f', 'Bib Groups', resp) }}
			{{ render_2level_hier_facet_box('grant_f', 'Grants', resp) }}
			{{ render_facet_box('data_f', 'Data', resp) }}
			{{ render_facet_box('vizier_f', 'Vizier Tables', resp) }}
			{{ render_facet_box('year_f', 'Year', resp) }}
			{#{ render_facet_box('prop_f', 'Property', resp) }#}
			</div>
		</div>
		<div class="span9 noMarginSpan" id="results">
			<form action="">
				<div class="container-fluid">
				{# The facet bar #}
				{% if resp.get_facet_parameters() %}
					{{ render_applied_facets_box(resp) }}
				{% endif %}		
				{# Navbar on top of the results #}
					<div class="row-fluid well well-small">
						<div class="span4 firstspan">
							{{ render_result_numbers(resp) }}
						</div>
						<div class="span3 pull-right">
							<!-- button class="btn pull-right">Sort</button-->
							<!-- button class="btn pull-right">More</button-->
							{{ render_re_sort(resp) }}
						</div>
					</div>
				{# The actual results #}
				{% for doc in resp.get_docset_objects() %}
				    {{ render_search_result(doc, loop, resp.get_start_count()) }}
				{% endfor %}
				</div>
			</form>
			{{ render_pagination(resp.get_pagination()) }}
		</div>
	</div>
</div>

{% endblock %}

{% if g.conf_params['PRINT_DEBUG_TEMPLATE'] %}
	{% block debugSection %}
		Request to SOLR: {{ resp.request.get_raw_request_url() }}
	{% endblock %}
{% endif %}